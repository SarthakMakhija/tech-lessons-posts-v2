---
import BaseHead from "../components/BaseHead.astro";
import MainSidebar from "../components/MainSidebar.astro";
import MobileNav from "../components/MobileNav.astro";
import Footer from "../components/Footer.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../consts";

interface Props {
	title?: string;
	description?: string;
}

const { title = SITE_TITLE, description = SITE_DESCRIPTION } = Astro.props;
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={title} description={description} />
	</head>
	<body
		class="bg-white text-zinc-900 min-h-screen flex flex-col md:flex-row selection:bg-black selection:text-white"
	>
		<MobileNav />
		<MainSidebar />
		<div class="flex-1 flex flex-col min-w-0">
			<main
				class="flex-1 max-w-[1280px] mx-auto px-6 py-12 md:py-20 w-full"
			>
				<slot />
			</main>
			<Footer />
		</div>
		<!-- Subtle gradient glow at the bottom/edges (optional, keeping it really subtle) -->
		<div
			class="fixed inset-0 pointer-events-none z-[-1] bg-[radial-gradient(circle_at_50%_120%,rgba(120,119,198,0.1),rgba(255,255,255,0))]"
		>
		</div>
		<script>
			// Add copy button to code blocks
			document.addEventListener("DOMContentLoaded", () => {
				const codeBlocks = document.querySelectorAll("pre");

				codeBlocks.forEach((codeBlock) => {
					// Create button
					const copyButton = document.createElement("button");
					copyButton.className = "copy-code-button";
					copyButton.innerHTML = `
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
							<path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
						</svg>
					`;
					copyButton.ariaLabel = "Copy code";

					// Wrapper for positioning
					const wrapper = document.createElement("div");
					wrapper.className = "code-block-wrapper relative group";

					// Wrap the pre block
					if (codeBlock.parentNode) {
						codeBlock.parentNode.insertBefore(wrapper, codeBlock);
						wrapper.appendChild(codeBlock);
						wrapper.appendChild(copyButton);
					}

					// Copy functionality
					copyButton.addEventListener("click", async () => {
						const codeText =
							codeBlock.querySelector("code")?.innerText ||
							codeBlock.innerText;

						try {
							await navigator.clipboard.writeText(codeText);

							// Visual feedback
							copyButton.innerHTML = `
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-500">
									<polyline points="20 6 9 17 4 12"></polyline>
								</svg>
							`;

							setTimeout(() => {
								copyButton.innerHTML = `
									<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
										<rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
										<path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
									</svg>
								`;
							}, 2000);
						} catch (err) {
							console.error("Failed to copy:", err);
						}
					});
				});
			});
		</script>

		<style is:global>
			.copy-code-button {
				position: absolute;
				top: 0.5rem;
				right: 0.5rem;
				padding: 0.4rem;
				background-color: rgba(255, 255, 255, 0.8);
				border: 1px solid #e4e4e7;
				border-radius: 0.375rem;
				color: #52525b;
				transition: all 0.2s;
				opacity: 0;
				cursor: pointer;
				z-index: 10;
			}

			.code-block-wrapper:hover .copy-code-button {
				opacity: 1;
			}

			.copy-code-button:hover {
				background-color: #f4f4f5;
				color: #18181b;
			}
		</style>
	</body>
</html>
