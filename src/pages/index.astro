---
import Layout from "../layouts/Layout.astro";
import { SITE_TITLE } from "../consts";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog")).sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

// Group posts by year
const postsByYear = posts.reduce(
    (acc, post) => {
        const year = post.data.pubDate.getFullYear();
        if (!acc[year]) acc[year] = [];
        acc[year].push(post);
        return acc;
    },
    {} as Record<number, typeof posts>,
);

const years = Object.keys(postsByYear)
    .sort((a, b) => Number(b) - Number(a))
    .map(Number);
---

<Layout title={SITE_TITLE}>
    <div class="max-w-[800px] mx-auto">
        <!-- Intro Section -->
        <section class="mb-16">
            <p class="text-lg text-zinc-700 leading-relaxed">
                I'm <strong>Sarthak Makhija</strong>, a <strong
                    >Principal Architect</strong
                > at <strong>Caizin</strong>. I write long-form essays on
                refactoring, storage engines, databases, and engineering
                trade-offs.
            </p>
            <p class="intent">Writing for future-me.</p>
        </section>

        <!-- Essay List -->
        <section>
            <h2
                class="font-mono text-sm uppercase tracking-wider text-zinc-900 mb-8 font-bold"
            >
                Essays
            </h2>

            <div class="flex flex-col">
                {
                    years.map((year) => (
                        <div class="mb-8">
                            {postsByYear[year].map((post, index) => (
                                <div class="group flex items-baseline py-2 border-b border-zinc-100 hover:border-zinc-200 transition-colors">
                                    {/* Year column: Show only for first item of the year */}
                                    <div class="w-16 font-mono text-sm text-zinc-900 shrink-0 font-bold">
                                        {index === 0 ? year : ""}
                                    </div>

                                    {/* Date Column */}
                                    <div class="w-16 font-mono text-sm text-zinc-900 shrink-0 hidden sm:block font-bold">
                                        {post.data.pubDate.toLocaleDateString(
                                            "en-GB",
                                            {
                                                day: "2-digit",
                                                month: "2-digit",
                                            },
                                        )}
                                    </div>

                                    {/* Title Column */}
                                    <a
                                        href={`/en/blog/${post.slug}/`}
                                        class="font-mono font-medium text-zinc-700 hover:text-black hover:translate-x-1 transition-all"
                                    >
                                        {post.data.title}
                                    </a>
                                </div>
                            ))}
                        </div>
                    ))
                }
            </div>
        </section>
    </div>
</Layout>
